import{H as e,r as t,n as l,s as a,az as o,y as n,f as i,o as s,l as r,g as d,M as u,P as c,_ as p,aa as m,a5 as f,m as h,T as v,O as g,X as y,aL as C,aM as b,Y as w,aN as x,S as k,Z as F,a2 as _,U as L,V as D,W as I,F as S,ae as $,$ as T,q as V,ab as N,p as U,a8 as A,a4 as E,aH as j}from"./vue.e8b9c5bb.js";import{a as J,i as R,z as M}from"./element-plus.1abf0d6a.js";import{G as O,C as P,F as W,K as z,D as B,H}from"./vendor.b9c91d43.js";import{J as q}from"./jsoneditor.450db7cc.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const l of e)if("childList"===l.type)for(const e of l.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var G=(e,t)=>{const l=e.__vccOpts||e;for(const[a,o]of t)l[a]=o;return l};var X=G(e({props:{type:{type:String}},setup(e){const i=t(),{uiControl:s}=l("control")||{};let r;return a((()=>{i.value&&(r=new O(i.value,{container:window,pinchOutside:!0}).on("drag",(t=>{if(!i.value||!s)return;let{right:l,left:a}={...o(null==s?void 0:s.get("columnWidth"))};"right"==e.type?l-=t.deltaX:a+=t.deltaX,null==s||s.set("columnWidth",{left:a,right:l})})))})),n((()=>{null==r||r.unset()})),{target:i}}}),[["render",function(e,t,l,a,o,n){return s(),i("div",{class:"starfish-editor-resizer",onMousedown:t[0]||(t[0]=(...t)=>e.handleLine&&e.handleLine(...t)),ref:"target"},null,544)}],["__scopeId","data-v-08005920"]]);const K=e({components:{Resizer:X},setup(){const{uiControl:e}=l("control")||{};return{columnWidth:r((()=>null==e?void 0:e.get("columnWidth")))}}}),Y={class:"starfish-editor"},Z={class:"starfish-editor-nav"},Q={class:"starfish-editor-content"};var ee=G(K,[["render",function(e,t,l,a,o,n){var r,f,h;const v=m("resizer");return s(),i("div",Y,[d("div",Z,[u(e.$slots,"nav",{},void 0,!0)]),d("div",Q,[d("div",{class:"starfish-editor-framework-left",style:c(`width:${null==(r=e.columnWidth)?void 0:r.left}px`)},[u(e.$slots,"left",{},void 0,!0)],4),p(v,{type:"left"}),d("div",{class:"starfish-editor-framework-center",style:c(`width:${null==(f=e.columnWidth)?void 0:f.center}px`)},[u(e.$slots,"navlist",{},void 0,!0),u(e.$slots,"workspace",{},void 0,!0)],4),p(v,{type:"right"}),d("div",{class:"starfish-editor-framework-right",style:c(`width:${null==(h=e.columnWidth)?void 0:h.right}px`)},[u(e.$slots,"propsPanel",{},void 0,!0)],4)]),u(e.$slots,"other",{},void 0,!0)])}],["__scopeId","data-v-0324365a"]]);const te=[{ControlType:"Switch",nameCn:"开关",data:{fieldName:"Inline",label:"Inline布局",tip:"",value:"",showRule:"{}",required:!1,rule:"[]",default:!1}},{ControlType:"Selected",nameCn:"选择器",data:{fieldName:"layout",label:"布局",tip:"",placeholder:"",showRule:"{}",required:!1,rule:"[]",itemConfig:{value:"3",items:[{label:"一行一列",value:"1",select:!0,id:1},{label:"一行二列",value:"2",select:!1,id:2},{label:"一行三列",value:"3",select:!1,id:3}],id:3}}},{ControlType:"Selected",nameCn:"选择器",data:{fieldName:"labelAlign",label:"标签对齐方式",showRule:"{}",rule:"[]",itemConfig:{value:"right",items:[{label:"Top",value:"top",select:!0,id:1},{label:"Left",value:"left",id:2},{label:"Right",value:"right",select:!1,id:4}],id:4}}},{ControlType:"Slider",nameCn:"滑块",data:{fieldName:"labelWidth",label:"标签宽度",tip:"",showRule:"{}",required:!1,rule:"[]",default:0,min:0,max:"400"}},{ControlType:"Text",nameCn:"文本框",data:{fieldName:"suffix",label:"表单项后缀",tip:"",placeholder:"",showRule:"{}",required:!1,rule:"[]",default:":"}}],le=f({historyList:[],index:-1,historyFlag:!1});var ae=new class{setValue(e){le.historyList.push(e),le.index=le.historyList.length-1}back(){-1!=le.index&&(le.index-=1,le.index>-1?(le.historyFlag=!0,null==ne||ne.set("allFormList",le.historyList[le.index].allFormList),null==ne||ne.set("currentIndex",le.historyList[le.index].currentIndex),null==ne||ne.set("curControl",le.historyList[le.index].curControl)):(le.historyFlag=!0,null==ne||ne.set("allFormList",[]),null==ne||ne.set("currentIndex",-1),null==ne||ne.set("curControl",{})))}go(){le.index>=le.historyList.length-1||(le.index+=1,le.historyFlag=!0,null==ne||ne.set("allFormList",le.historyList[le.index].allFormList),null==ne||ne.set("currentIndex",le.historyList[le.index].currentIndex),null==ne||ne.set("curControl",le.historyList[le.index].curControl))}get(e){return le[e]}set(e,t){le[e]=t}};const oe=f({allFormList:[],curControl:{},currentIndex:-1,preview:!1,previewShow:!1,save:!1,saveTimetemp:(new Date).getTime(),formUpdate:!1,AllFormResult:[],formResult:{},globalDatas:{Inline:!1,layout:"1",labelAlign:"top",labelWidth:400,suffix:":"}});var ne={updateAllFormList(e){oe.allFormList=e,-1!=oe.currentIndex&&(oe.curControl=e[oe.currentIndex])},setHistory(){null==ae||ae.setValue({allFormList:window.VueContext.$Flex.deepClone(oe.allFormList),currentIndex:oe.currentIndex,curControl:window.VueContext.$Flex.deepClone(oe.allFormList[oe.currentIndex])})},setFormCurrentIndex(e){if(oe.currentIndex=e,e&&-1!=e){let t;oe.allFormList.find((l=>{if(l.id==e)return t=l,!0;if(l.layout){const a=this.getGridCurCtrol(l,e);if(a)return t=a,!0}})),oe.curControl=t||{}}else oe.curControl={}},getGridCurCtrol(e,t){const l=e.data.columns;let a;return l&&l.length>0&&l.find((e=>e.list.find((e=>{e.layout?a=this.getGridCurCtrol(e,t):e.id==t&&(a=e)})))),a},setPreviewShow(e){oe.previewShow=e},handleDynamicForm(){const e={};oe.AllFormResult.forEach((t=>{t.data.itemConfig?"string"==typeof t.data.itemConfig.value?e[t.data.fieldName]=t.data.itemConfig.value:e[t.data.fieldName]=[...t.data.itemConfig.value]:e[t.data.fieldName]=t.data.default})),oe.formResult=e},openPreview(e){oe.preview=e},setSave(e){oe.save=e},setFormUpdate(e){oe.formUpdate=e},getControlItems:()=>oe.curControl&&oe.curControl.controlItems,getAllFormList:()=>oe.allFormList,set(e,t){oe[e]=t,console.log("admin store set ",e," ",t)},get:e=>oe[e]};var ie=new class{constructor(){this.lastClickTime=0,this.openTanc=!1}clickCountLimit(){let e=!1;if(window.clickCountLimitMock)return!0;if(this.lastClickTime){const t=(new Date).getTime()-this.lastClickTime;this.lastClickTime=(new Date).getTime(),e=t>=1e3}else this.lastClickTime=(new Date).getTime(),e=!0;return e||console.log("手残党点击太快了"),e}generateMixed(){return P()}controlFormRule(e){const t={};return e.forEach((e=>{const l=[];e.data.required&&(l.push({required:!0,message:"请输入"+e.data.label,trigger:"blur"}),t[e.data.fieldName]=l),"JsonEditor"===e.ControlType&&(t[e.data.fieldName]=this.getJsonValidate())})),t}deepClone(e){let t;if("object"==typeof e)if(Array.isArray(e)){t=[];for(let l=0;l<e.length;l++)Object.prototype.hasOwnProperty.call(e,l)&&t.push(this.deepClone(e[l]))}else if(null===e)t=null;else if(e.constructor===RegExp)t=e;else{t={};for(const l in e)Object.prototype.hasOwnProperty.call(e,l)&&(t[l]=this.deepClone(e[l]))}else t=e;return t}tryParseJson(e){try{return JSON.parse(e)}catch(t){return e&&e.startsWith&&e.startsWith('"[')?[]:{}}}open(e,t="Success",l="success"){J({title:t||"Success",message:e,type:l})}getJsonValidate(){return this.deepClone([{validator:(e,t,l)=>{try{JSON.parse(t),l()}catch(a){return console.error(a),l(new Error("请输入正确的json格式"))}},trigger:"blur"}])}getDataType(e){return Object.prototype.toString.call(e).match(/\[object (.*)\]/)[1]}};const se=f({form:oe,editType:1,copyContent:null});var re={copy(){1==se.editType&&se.form.currentIndex>-1&&(se.copyContent=se.form.allFormList[se.form.currentIndex])},paste(){if(1==se.editType&&se.copyContent){const e=window.VueContext.$Flex.deepClone(se.copyContent);e.data.fieldName=e.ControlType+"_"+ie.generateMixed(),se.form.allFormList.push(e),se.form.formUpdate=!0}},delete(){1==se.editType&&(se.form.allFormList.splice(se.form.currentIndex,1),se.form.curControl={},se.form.formUpdate=!0,se.form.currentIndex=-1)},onTop(){if(1==se.editType&&se.form.currentIndex>0){const e=se.form.allFormList.splice(se.form.currentIndex,1);se.form.currentIndex-=1,se.form.allFormList.splice(se.form.currentIndex,0,...e)}},onBottom(){if(1==se.editType&&se.form.currentIndex<se.form.allFormList.length-1){const e=se.form.allFormList.splice(se.form.currentIndex,1);se.form.currentIndex+=1,se.form.allFormList.splice(se.form.currentIndex,0,...e)}},clear(){1==se.editType&&(se.form.allFormList.length=0,se.form.formUpdate=!0)},moveTop(){se.form.currentIndex>0&&(se.form.currentIndex-=1)},moveBottom(){se.form.currentIndex<se.form.allFormList.length-1&&(se.form.currentIndex+=1)},set(e,t){se[e]=t,console.log("admin store set ",e," ",t)},get:e=>se[e],commit(e){this[e]()}};function de(){re.commit("copy")}function ue(){re.commit("paste")}function ce(){re.commit("copy"),re.commit("delete")}function pe(){re.commit("delete")}function me(){re.commit("onTop")}function fe(){re.commit("onBottom")}var he={copy:de,paste:ue,cut:ce,delete:pe,onTop:me,onBottom:fe};const ve=e({setup(){const{proxy:e}=h(),{hisContrl:t,uiControl:o}=l("control")||{},i=r((()=>null==ne?void 0:ne.get("formUpdate"))),s=r((()=>null==ne?void 0:ne.get("saveTimetemp"))),d=r((()=>{var e;return 0==(null==(e=null==ne?void 0:ne.get("allFormList"))?void 0:e.length)})),u=r((()=>null==t?void 0:t.get("index"))),c=r((()=>null==t?void 0:t.get("historyList").length)),p=r((()=>null==o?void 0:o.get("isFullscreen")));let m=null;const f=t=>{!ne.get("save")||i.value||t?(ne.set("saveTimetemp",(new Date).getTime()),e.$EventBus.emit("setSave",t)):e.$Flex.open("已保存，请不要重复保存","Warning","warning")};return a((()=>{m=setInterval((()=>{(new Date).getTime()-s.value>3e5&&f("auto")}),2e4)})),n((()=>{clearInterval(m)})),{handleFormSave:f,handleFormPre:()=>{e.$EventBus.emit("openPreview")},historyIndex:u,historyLen:c,fullscreen:p,clearIsDisable:d,handleClear:()=>{re.commit("clear"),ne.setFormCurrentIndex(-1)},handleBack:()=>{null==t||t.back()},handleForward:()=>{null==t||t.go()},handleFullScreen:()=>{null==o||o.set("isFullscreen",!(null==o?void 0:o.get("isFullscreen")))}}}}),ge={class:"nav"},ye={class:"detailBtn"};var Ce=G(ve,[["render",function(e,t,l,a,o,n){const r=m("el-tooltip");return s(),i("div",ge,[d("div",ye,[p(r,{class:"box-item",effect:"dark",content:"保存",placement:"top"},{default:v((()=>[d("span",{class:g(["iconfont icon-baocun",e.clearIsDisable?"noactive":""]),onClick:t[0]||(t[0]=t=>e.handleFormSave())},null,2)])),_:1}),p(r,{class:"box-item",effect:"dark",content:"预览",placement:"top"},{default:v((()=>[d("span",{class:g(["iconfont icon-icon_yulan",e.clearIsDisable?"noactive":""]),onClick:t[1]||(t[1]=t=>e.handleFormPre())},null,2)])),_:1}),p(r,{class:"box-item",effect:"dark",content:"全屏",placement:"top"},{default:v((()=>[e.fullscreen?y("",!0):(s(),i("span",{key:0,class:"iconfont icon-quanping",onClick:t[2]||(t[2]=t=>e.handleFullScreen())}))])),_:1}),p(r,{class:"box-item",effect:"dark",content:"非全屏",placement:"top"},{default:v((()=>[e.fullscreen?(s(),i("span",{key:0,class:"iconfont icon-suoxiao1",onClick:t[3]||(t[3]=t=>e.handleFullScreen())})):y("",!0)])),_:1}),p(r,{class:"box-item",effect:"dark",content:"清空",placement:"top"},{default:v((()=>[d("span",{class:g(["iconfont icon-shanchu1",e.clearIsDisable?"noactive":""]),onClick:t[4]||(t[4]=t=>e.handleClear())},null,2)])),_:1}),p(r,{class:"box-item",effect:"dark",content:"撤销",placement:"top"},{default:v((()=>[d("span",{class:g(["iconfont icon-24gl-undo3",-1==e.historyIndex?"noactive":""]),onClick:t[5]||(t[5]=t=>e.handleBack())},null,2)])),_:1}),p(r,{class:"box-item",effect:"dark",content:"重做",placement:"top"},{default:v((()=>[d("span",{class:g(["iconfont icon-24gl-redo3",e.historyIndex==e.historyLen-1?"noactive":""]),onClick:t[6]||(t[6]=t=>e.handleForward())},null,2)])),_:1})])])}],["__scopeId","data-v-cca8d8c0"]]);const be=e({}),we=e=>(C("data-v-3f0dbfbe"),e=e(),b(),e),xe={class:"nav"},ke=[we((()=>d("div",{class:"logo"},[d("div",null,[d("span",null,"starfish"),w(" 表单设计器")])],-1))),we((()=>d("div",{class:"starfish-link"},[d("a",{href:"https://github.com/haixin-fang/starfish-vue3-lowcode",target:"_black"},"GitHub")],-1)))];var Fe=G(be,[["render",function(e,t,l,a,o,n){return s(),i("div",xe,ke)}],["__scopeId","data-v-3f0dbfbe"]]);const _e=e({components:{draggable:x},data(){const e=this.$formcomponents,t=[];for(const l in e){const a=e[l];if(a.isHide)continue;const o={};o.ControlType=a.ControlType,o.icon=a.icon,o.nameCn=a.nameCn,o.layout=!!a.layout,a.rule&&(o.rule=a.rule),t.push(o)}return console.log(t),{formcomponents:t,filterContent:""}},computed:{newcomponentlist(){return this.formcomponents.filter((e=>{if(-1!=e.nameCn.indexOf(this.filterContent)&&!e.layout)return!0}))},layoutList(){return this.formcomponents.filter((e=>{if(e.layout)return!0}))}}}),Le=w("基础控件"),De=["alt"],Ie={class:"form-item"},Se={class:"item-text"},$e=w("布局控件"),Te=["alt"],Ve={class:"form-item"},Ne={class:"item-text"};var Ue=G(_e,[["render",function(e,t,l,a,o,n){const i=m("el-input"),r=m("el-button"),u=m("draggable"),c=m("el-scrollbar");return s(),k(c,{class:"editor_pages_left"},{default:v((()=>[p(i,{placeholder:"请输入关键词进行过滤",size:"",modelValue:e.filterContent,"onUpdate:modelValue":t[0]||(t[0]=t=>e.filterContent=t)},null,8,["modelValue"]),p(r,{type:"text"},{default:v((()=>[Le])),_:1}),p(u,{class:"dragArea list-group",list:e.newcomponentlist,group:{name:"starfish-form",pull:"clone",put:!1},sort:!1,"item-key":"id"},{item:v((({element:e})=>[d("div",{class:"list-group-item",alt:e.nameCn},[d("div",Ie,[d("span",{class:g(["iconfont",e.icon])},null,2)]),d("div",Se,F(e.nameCn),1)],8,De)])),_:1},8,["list"]),p(r,{type:"text"},{default:v((()=>[$e])),_:1}),p(u,{class:"dragArea list-group",list:e.layoutList,group:{name:"starfish-form",pull:"clone",put:!1},sort:!1,"item-key":"id"},{item:v((({element:e})=>[d("div",{class:"list-group-item",alt:e.nameCn},[d("div",Ve,[d("span",{class:g(["iconfont",e.icon])},null,2)]),d("div",Ne,F(e.nameCn),1)],8,Te)])),_:1},8,["list"])])),_:1})}],["__scopeId","data-v-4e316973"]]);const Ae=e({setup(){const{proxy:e}=h(),{uiControl:a}=l("control")||{},o=e.$formcomponents,n=t(),i=t(1),s=t(),d=t(!1),u=t(),c=r((()=>re.get("editType"))),p=r((()=>null==ne?void 0:ne.get("globalDatas"))),m=r((()=>null==a?void 0:a.get("isFullscreen"))),f=r({get:()=>ne.get("allFormList"),set(t){t=t.map((t=>{if(!t.data&&!t.controlItems){(t=e.$Flex.deepClone(t)).formConfig=o[t.ControlType].formConfig,t.data=t.formConfig.data(),t.data.fieldName||(t.data.fieldName=t.ControlType+"_"+e.$Flex.generateMixed()),t.id=e.$Flex.generateMixed();const l=t.formConfig.morenConfig();t.rules=e.$Flex.controlFormRule(l,t),t.controlItems=l}return console.log("item",t),t})),ne.updateAllFormList(t)}}),v=r((()=>ne.get("currentIndex")));return{scale:r((()=>null==a?void 0:a.get("scale"))),globalDatas:p,canvasBox:n,editForm:u,handleCanvasSize:t=>{e.$Flex.clickCountLimit()&&("add"===t&&i.value<1.5?i.value=Number((i.value+.1).toFixed(2)):"cut"===t&&i.value>.5?i.value=Number((i.value-.1).toFixed(2)):"restore"===t&&(i.value=1),n.value.style.transform=`scale(${i.value})`)},canvasSize:i,dragDom:s,chooseClick:e=>{var t;ne.setFormCurrentIndex(null==(t=f.value[e.oldIndex])?void 0:t.id)},addControl:e=>{var t;ne.setFormCurrentIndex(null==(t=f.value[e.newIndex])?void 0:t.id)},changePos:e=>{var t;ne.setFormCurrentIndex(null==(t=f.value[e.oldIndex])?void 0:t.id)},allmainList:f,currentIndex:v,handleNoDraggable:e=>{d.value&&(d.value=!1),e.preventDefault();const t=e.path;for(let o=0;o<t.length;o++)if(t[o].getAttribute&&t[o].getAttribute("class")&&t[o].getAttribute("class").indexOf("shape")>=0)return;const l=e.offsetX,a=e.offsetY;_((()=>{u.value.style.left=l+"px",u.value.style.top=a+"px",d.value=!0}))},editType:c,handlePaste:()=>{d.value=!1,ue()},pasteShow:d,fullScreen:m,onEditorCenter:e=>{"editor_pages_center"==e.path[0].className&&(ne.setFormCurrentIndex(-1),d.value=!1)}}}}),Ee={class:"editForm",ref:"editForm"},je={key:0,class:"form-empty"};var Je=G(Ae,[["render",function(e,t,l,a,o,n){const r=m("Shape"),u=m("draggable");return s(),i("div",{class:"editor_pages_center",onClick:t[3]||(t[3]=(...t)=>e.onEditorCenter&&e.onEditorCenter(...t))},[d("div",{class:g(["canvasBox",e.fullScreen?"fullScreenBox":""]),ref:"canvasBox",style:c(`transform: translateX(-50%) scale(${e.scale})`)},[d("div",{class:"draggable_container",ref:"dragDom",onContextmenu:t[2]||(t[2]=(...t)=>e.handleNoDraggable&&e.handleNoDraggable(...t))},[L(d("div",Ee,[d("span",{onClick:t[0]||(t[0]=(...t)=>e.handlePaste&&e.handlePaste(...t))},"粘贴")],512),[[D,e.pasteShow]]),p(u,{class:"dragArea list-group",animation:"300",ghostClass:"itemGhost",modelValue:e.allmainList,"onUpdate:modelValue":t[1]||(t[1]=t=>e.allmainList=t),onAdd:e.addControl,group:"starfish-form",onChoose:e.chooseClick,"item-key":"id",onUpdate:e.changePos},{item:v((({element:t})=>[p(r,{active:e.currentIndex==t.id,currentIndex:t.id,len:e.allmainList.length,inline:e.globalDatas.Inline,layout:!!t.layout},{default:v((()=>[(s(),k(I(t.ControlType),{drag:!0,item:t,data:{},inline:e.globalDatas.Inline,layout:e.globalDatas.layout,labelalign:e.globalDatas.labelAlign,labelWidth:e.globalDatas.labelWidth,suffix:e.globalDatas.suffix},null,8,["item","inline","layout","labelalign","labelWidth","suffix"]))])),_:2},1032,["active","currentIndex","len","inline","layout"])])),_:1},8,["modelValue","onAdd","onChoose","onUpdate"]),0==e.allmainList.length?(s(),i("div",je,"从左侧拖拽来添加字段")):y("",!0)],544)],6)])}],["__scopeId","data-v-34488606"]]);const Re=e({setup:()=>({keyList:f([{key:"ctrl + C",value:"复制组件"},{key:"ctrl + V",value:"粘贴组件"},{key:"ctrl + X",value:"裁剪组件"},{key:"delete",value:"删除组件"},{key:"ctrl + E",value:"清空画布"},{key:"ctrl + ↑",value:"组件上移"},{key:"ctrl + ↓",value:"组件下移"},{key:"↑",value:"选中上移"},{key:"↓",value:"选中下移"}])})}),Me=e=>(C("data-v-02ca478f"),e=e(),b(),e),Oe={class:"shortCutKey"},Pe=Me((()=>d("div",{class:"title"},"快捷键",-1))),We={class:"keyContent"},ze=Me((()=>d("div",{class:"san"},null,-1)));var Be=G(Re,[["render",function(e,t,l,a,o,n){return s(),i("div",Oe,[Pe,d("div",We,[(s(!0),i(S,null,$(e.keyList,((e,t)=>(s(),i("div",{key:t},[d("span",null,F(e.key),1),d("span",null,F(e.value),1)])))),128))]),ze])}],["__scopeId","data-v-02ca478f"]]);const He=e({components:{shortcutKey:Be},setup(){const{uiControl:e}=l("control")||{},a=t(),o=t(!1);return{size:r((()=>null==e?void 0:e.get("scale"))),handleCanvasSize:t=>{t?null==e||e.set("scale",((null==e?void 0:e.get("scale"))||1)+t):null==e||e.set("scale",1)},controllerSize:a,shortCutShow:o,handleShortCutHidden:()=>{o.value=!1},handleShortcutShow:()=>{o.value=!0}}}}),qe=e=>(C("data-v-6ae7ef76"),e=e(),b(),e),Ge={class:"controller_edit_size",ref:"controllerSize"},Xe=[qe((()=>d("i",{class:"iconfont icon-jiahao"},null,-1)))],Ke=[qe((()=>d("i",{class:"iconfont icon-jianhao"},null,-1)))],Ye=qe((()=>d("i",{class:"iconfont icon-jianpan_o"},null,-1))),Ze=[qe((()=>d("i",{class:"iconfont icon-huanyuan"},null,-1)))];var Qe=G(He,[["render",function(e,t,l,a,o,n){const r=m("shortcutKey");return s(),i("div",Ge,[d("span",{onClick:t[0]||(t[0]=t=>e.handleCanvasSize(.1))},Xe),d("span",null,F(parseInt(100*e.size))+"%",1),d("span",{onClick:t[1]||(t[1]=t=>e.handleCanvasSize(-.1))},Ke),d("span",{onMouseover:t[2]||(t[2]=(...t)=>e.handleShortcutShow&&e.handleShortcutShow(...t)),onMouseleave:t[3]||(t[3]=(...t)=>e.handleShortCutHidden&&e.handleShortCutHidden(...t))},[Ye,p(T,{name:"slide-fade"},{default:v((()=>[L(p(r,null,null,512),[[D,e.shortCutShow]])])),_:1})],32),d("span",{onClick:t[4]||(t[4]=t=>e.handleCanvasSize()),title:"复位"},Ze)],512)}],["__scopeId","data-v-6ae7ef76"]]);const et=e({components:{ControllEditSize:Qe},setup(){const{proxy:e}=h(),{uiControl:a,hisContrl:n}=l("control")||{},i=t(!0),s=t(!0),d=t(),u=t(),c=t("form"),p=t();let m=null;const f=t(!0),v=e.$formcomponents,g=r((()=>ne.getControlItems())),y=r((()=>ne.get("curControl"))),C=r((()=>e.$Flex.deepClone(ne.get("curControl")))),b=r((()=>null==n?void 0:n.get("historyFlag"))),w=r((()=>ne.get("save"))),x=r((()=>ne.get("currentIndex"))),k=t(te),F=r((()=>null==ne?void 0:ne.get("globalDatas"))),L=r((()=>ne.get("preview"))),D=r((()=>ne.getAllFormList())),I=function(t,l){return new Promise((a=>{d.value.validate((o=>{o?a(!0):(e.$Flex.open(t,l,"error"),a(!1))}))}))},S=r((()=>null==ne?void 0:ne.get("formUpdate"))),$=r((()=>null==ne?void 0:ne.get("allFormList"))),T=r((()=>e.$Flex.deepClone(null==ne?void 0:ne.get("allFormList")))),N=async(t=!1,l)=>{const a=ne.get("currentIndex");if(L.value||w.value||S.value){const n=await(async()=>{const e=D.value.length;for(let t=0;t<e;++t){let e=!0;const l=D.value[t];if(!(l.controlItems.forEach((t=>{t.data.required&&(e=!!l.data[t.data.fieldName])})),e||(ne.setFormCurrentIndex(t),await _(),await I("请检查动态表单输入格式问题","表单验证失败"))))return!1}return!0})();if(n&&ne.setFormCurrentIndex(a),ne.setSave(n),ne.setFormUpdate(!1),n){const t=[];o(D.value).forEach((l=>{t.push({data:l.data,ControlType:l.ControlType,id:e.$Flex.generateMixed()})})),ne.set("AllFormResult",t),ne.handleDynamicForm()}t?n&&e.$Flex.open(l?"已自动保存":"保存成功"):(ne.set("previewShow",n),ne.set("preview",!1))}},U=e=>{const t=[];return o(e).forEach((e=>{const l={ControlType:e.ControlType,nameCn:e.nameCn,data:e.data};t.push(l)})),t};function A(){const e=p.value;if(m)null==m||m.set(U($.value));else{const t={modes:["text","code","view"],mode:"code",search:!1};m=new window.JSONEditor(e,t),null==m||m.set(U($.value))}}return e.$EventBus.on("openPreview",(async()=>{N()})),e.$EventBus.on("setSave",(async e=>{N(!0,e)})),V((()=>{var e;return[T.value,null==(e=C.value)?void 0:e.data]}),(([,e],[,t])=>{A(),b.value?null==n||n.set("historyFlag",!1):function(e,t){if(e!==t)return!1;let l=!0;for(const a in e)e[a]!==t[a]&&(l=!1);return l}(e,t)||null==ne||ne.setHistory()}),{deep:!0}),V((()=>F),(e=>{console.log(e)}),{deep:!0}),V((()=>{var e;return null==(e=y.value)?void 0:e.data}),(async()=>{S.value||ne.setFormUpdate(!0)}),{deep:!0}),{globalFormLists:k,globalDatas:F,jsonCenter:p,handleClick:function(t){if("json"==t.props.name)A();else if("form"==t.props.name)try{const t=e.$Flex.tryParseJson(m.getText()),l=[];let a=null;a=o(t).map((t=>{if(!t.data||!t.controlItems){(t=ie.deepClone(t)).formConfig=v[t.ControlType].formConfig,t.data.fieldName||(t.data.fieldName=t.ControlType+"_"+e.$Flex.generateMixed()),l.includes(t.data.fieldName)?t.data.fieldName=t.ControlType+"_"+e.$Flex.generateMixed():l.push(t.data.fieldName);const a=t.formConfig.morenConfig();t.rules=e.$Flex.controlFormRule(a,t),t.controlItems=a}return t})),null==ne||ne.updateAllFormList(a)}catch(l){console.error(l)}},activeName:c,handleMouseDown:async()=>{ne.setFormCurrentIndex(-1)},moduleIsHidden:i,handleEditBtn:()=>{i.value=!i.value,i.value?null==a||a.set("columnWidth",{right:void 0}):null==a||a.set("columnWidth",{right:0})},isTransition:f,editRight:u,controlItems:g,curControl:y,ruleForm:d,show:s,currentIndex:x}}}),tt={class:"editor_pages_right editor_pages_right_visible",ref:"editRight"},lt={class:"json"},at={ref:"jsonCenter"};var ot=G(et,[["render",function(e,t,l,a,o,n){const r=m("el-form-item"),u=m("el-form"),c=m("el-empty"),f=m("el-scrollbar"),h=m("el-tab-pane"),C=m("el-tabs"),b=m("ControllEditSize");return s(),i("div",tt,[p(C,{modelValue:e.activeName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.activeName=t),class:"demo-tabs",onTabClick:e.handleClick,style:{height:"100%"}},{default:v((()=>[p(h,{label:"组件配置",name:"form"},{default:v((()=>[p(f,{class:"dynamic"},{default:v((()=>[p(u,{ref:"ruleForm",model:e.curControl&&(e.curControl.data||{}),rules:e.curControl&&e.curControl.rules,"label-width":"120px","status-icon":!0},{default:v((()=>[(s(!0),i(S,null,$(e.controlItems,(t=>(s(),k(r,{key:t.id,control:t.ControlType,prop:t.data.fieldName},{default:v((()=>[e.show&&"JsonEditor"===t.ControlType||"JsonEditor"!==t.ControlType?(s(),k(I(t.ControlType),{key:0,drag:!1,data:e.curControl.data,item:t},null,8,["data","item"])):y("",!0)])),_:2},1032,["control","prop"])))),128))])),_:1},8,["model","rules"]),e.curControl&&e.curControl.data?y("",!0):(s(),k(c,{key:0,"image-size":200,description:"没有选中表单控件"}))])),_:1})])),_:1}),p(h,{label:"JSON配置",name:"json"},{default:v((()=>[d("div",lt,[d("div",at,null,512)])])),_:1}),p(h,{label:"表单配置",name:"global"},{default:v((()=>[p(f,{class:"form_tab3"},{default:v((()=>[(s(!0),i(S,null,$(e.globalFormLists,(t=>(s(),i("div",{key:t.id,class:"form_tab3_list"},[(s(),k(I(t.ControlType),{item:t,data:e.globalDatas},null,8,["item","data"]))])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue","onTabClick"]),d("div",{class:"editor_container",onMousedown:t[1]||(t[1]=(...t)=>e.handleMouseDown&&e.handleMouseDown(...t))},[p(b)],32),d("div",{class:"editor_right_accept",onClick:t[2]||(t[2]=(...t)=>e.handleEditBtn&&e.handleEditBtn(...t))},[d("i",{class:g(["iconfont icon-jiantou_xiangyouliangci",e.moduleIsHidden?"icon-jiantou_xiangyouliangci":"icon-jiantou_xiangzuoliangci"])},null,2)])],512)}]]);const nt={left:300,center:window.document.body.clientWidth-300-378,right:378},it=f({columnWidth:nt,dialogWidth:500,scale:1,isFullscreen:!0});var st=new class{get(e){return it[e]}set(e,t){"columnWidth"===e?this.setColumnWidth(t):"scale"===e?this.setScale(Number(t)):it[e]=t}setScale(e){const t=[.2,1.5];e>=t[0]&&e<=t[1]&&(it.scale=e)}setColumnWidth({left:e,center:t,right:l}){const a={...o(this.get("columnWidth"))};if(a.left=e&&e>=0?e:nt.left,a.right=null!=l&&l>=0?l:nt.right,t&&"auto"!=t)a.center=t;else{const e=window.document.body.clientWidth;a.center=e-((null==a?void 0:a.left)||0)-((null==a?void 0:a.right)||0),a.center<=0&&(a.left=nt.left,a.center=nt.center,a.right=nt.right)}it.columnWidth=a,console.log(1,nt),console.log(2,a)}};const rt=e({components:{Dynamicform:W},setup(){const e=r((()=>ne.get("previewShow"))),l=r((()=>ne.get("AllFormResult"))),a=r((()=>ne.get("formResult"))),{proxy:o}=h(),n=t(),i=t();let s=null;V(e,(async()=>{if(e.value){i.value.init("表单预览","icon-biaodan"),await _();const e={modes:["text"],mode:"code",search:!1};s=new window.JSONEditor(d.value,e),null==s||s.set(o.$Flex.deepClone(a.value))}else i.value.close()})),V((()=>a),(()=>{null==s||s.set(o.$Flex.deepClone(a.value))}),{deep:!0});const d=t();return{dialogWidth:r((()=>null==st?void 0:st.get("dialogWidth"))),previewShow:e,previewDialog:i,handlePreviewShow:()=>{ne.set("previewShow",!1)},handleFormResult:()=>{n.value.ruleForm.validate((()=>{console.log(n.value)}))},JsonViewerDialog:d,allFormList:l,formResult:a,dynamicform:n}}}),dt={class:"previewList"},ut={ref:"JsonViewerDialog"};var ct=G(rt,[["render",function(e,t,l,a,o,n){const i=m("dynamicform"),r=m("CustomDialog");return s(),k(N,{to:"body"},[p(r,{ref:"previewDialog",showDialog:e.previewShow,onClose:e.handlePreviewShow},{default:v((()=>[d("div",dt,[d("div",null,[p(i,{formResult:e.formResult,allFormList:e.allFormList,ref:"dynamicform"},null,8,["formResult","allFormList"])]),d("div",null,[d("div",ut,null,512)])])])),_:1},8,["showDialog","onClose"])])}]]);var pt=G(e({name:"Editor",components:{Framework:ee,NavList:Ce,ComponentList:Ue,Workspace:Je,PropsPanel:ot,FormPreview:ct,Nav:Fe},setup(){const e=t(),l={uiControl:st,hisContrl:ae,formStore:ne};let o;return a((()=>{o=function(e,t){const l=new z(t),a=/mac os x/.test(navigator.userAgent.toLowerCase())?"meta":"ctrl";return l.keyup("delete",(t=>{t.inputEvent.preventDefault(),e.delete()})).keyup("backspace",(t=>{t.inputEvent.preventDefault(),e.delete()})).keydown([a,"c"],(t=>{t.inputEvent.preventDefault(),e.copy()})).keydown([a,"v"],(t=>{t.inputEvent.preventDefault(),e.paste()})).keydown([a,"x"],(t=>{t.inputEvent.preventDefault(),e.cut()})).keydown([a,"up"],(t=>{t.inputEvent.preventDefault(),e.toTop()})).keydown([a,"down"],(t=>{t.inputEvent.preventDefault(),e.toBottom()})),l}(he,document.body)})),n((()=>{o.destroy()})),U("control",l),{workspace:e}}}),[["render",function(e,t,l,a,o,n){const i=m("Nav"),r=m("nav-list"),d=m("component-list"),u=m("workspace"),c=m("props-panel"),f=m("form-preview"),h=m("framework");return s(),k(h,null,{nav:v((()=>[p(i)])),navlist:v((()=>[p(r)])),left:v((()=>[p(d)])),workspace:v((()=>[p(u,{ref:"workspace"},null,512)])),propsPanel:v((()=>[p(c)])),other:v((()=>[p(f)])),_:1})}]]);const mt=e({props:{dialogclass:String,showDialog:Boolean,width:Number},setup(e,{emit:l}){const a=t(!1),o=t(""),n=t(""),i=t(!1);return{isshow:a,title:o,icon:n,isFullScreen:i,init(e,t){o.value=e,n.value=t},show(){a.value=!0,l("open")},close(){a.value=!1,l("close")}}}}),ft={key:0,class:"MyDialogFrame"},ht={class:"pageContent",style:{height:"100%",padding:"0",overflow:"hidden","background-color":"transparent"}},vt={class:"my-icon"},gt={class:"my-title"},yt={class:"my-toolbar"},Ct=d("em",{class:"iconfont icon-guanbi"},null,-1),bt=d("div",{class:"myDialogMask"},null,-1);var wt=G(mt,[["render",function(e,t,l,a,o,n){const r=m("el-button"),f=m("el-header"),h=m("el-container");return e.isshow||e.showDialog?(s(),i("div",ft,[d("div",{class:g(["MyDialogBody",[{fullscreen:e.isFullScreen},e.dialogclass]]),style:c(`width: ${e.width}px`)},[d("div",ht,[p(h,{class:"my-pageContainer"},{default:v((()=>[p(f,{class:"my-pageHeader",style:{height:"45px"}},{default:v((()=>[d("div",vt,[d("em",{class:g(["iconfont",e.icon])},null,2)]),d("div",gt,F(e.title),1),d("div",yt,[p(r,{class:"my-toolbtn",onClick:t[0]||(t[0]=t=>e.isFullScreen=!e.isFullScreen)},{default:v((()=>[d("em",{class:g(["iconfont icon",{"icon-suoxiao1":e.isFullScreen,"icon-quanping":!e.isFullScreen}])},null,2)])),_:1}),p(r,{class:"my-toolbtn",onClick:e.close},{default:v((()=>[Ct])),_:1},8,["onClick"])])])),_:1}),u(e.$slots,"default")])),_:3})])],6),bt])):y("",!0)}]]);const xt=e({props:{data:{type:Object,default:()=>({})},item:{type:Object,default:()=>({})}},setup(e,{emit:l}){const a=t(),n=t(),i=r((()=>{var t;const l=null==ne?void 0:ne.get("allFormList");return null==(t=o(l))?void 0:t.filter((t=>{if(t.data.fieldName!==e.data.fieldName)return t})).map((e=>{var t,l,a,o,n,i,s,r,d;if("开关"==e.nameCn)return{value:null==(t=null==e?void 0:e.data)?void 0:t.fieldName,label:(null==(l=null==e?void 0:e.data)?void 0:l.label)+"-"+(null==(a=null==e?void 0:e.data)?void 0:a.fieldName),switch:!0};if(e.data.itemConfig){let t=!1;Array.isArray(e.data.itemConfig.value)&&(t=!0);const l=e.data.itemConfig.items;return{value:null==(o=null==e?void 0:e.data)?void 0:o.fieldName,label:(null==(n=null==e?void 0:e.data)?void 0:n.label)+"-"+(null==(i=null==e?void 0:e.data)?void 0:i.fieldName),multiple:t,options:l}}return{value:null==(s=null==e?void 0:e.data)?void 0:s.fieldName,label:(null==(r=null==e?void 0:e.data)?void 0:r.label)+"-"+(null==(d=null==e?void 0:e.data)?void 0:d.fieldName)}}))})),s=f({andData:[[]],logicList:[{value:"=",label:"等于"},{value:"!=",label:"不等于"}],typeList:[{value:"常量",label:"常量"}]});return{...A(s),fieldList:i,maxJsonDialog:a,formList:n,handleType(e,t,l){"布尔"==l&&(s.andData[t][e].value=!0)},getLogic(e,t){const l=i.value.find((l=>{if(s.andData[t][e]&&l.value==s.andData[t][e].field)return l}));return l&&l.options&&l.multiple?[{value:"in",label:"包含"},{value:"not in",label:"不包含"}]:l&&l.switch?[{value:"=",label:"等于"}]:s.logicList},getFiled(e,t){if(!s.andData[t][e]||!s.andData[t][e].field)return[];return this.fieldList.find((l=>{if(s.andData[t][e]&&l.value==s.andData[t][e].field)return l})).options||[]},show(){a.value.init("可用条件","icon-bianji"),a.value.show()},getMultiple:(e,t)=>!!i.value.find((l=>{if(s.andData[t][e]&&l.value==s.andData[t][e].field)return l})).multiple,getNewTypeList(e,t){const l=i.value.find((l=>{if(s.andData[t][e]&&l.value==s.andData[t][e].field)return l}));return l&&l.options?[{rule:[],value:"选项",label:"选项"}]:l&&l.switch?[{value:"布尔",label:"布尔"}]:this.typeList},deleteRow(e,t){s.andData[t].splice(e,1)},getTypeIsChange:(e,t)=>!!s.andData[t][e].type,getRules(e){var t;return{value:null==(t=s.typeList.find((t=>t.value==e)))?void 0:t.rule}},async onAddItem(e){s.andData[e].push({field:"",logic:"",type:"",value:""})},onOrItem(){s.andData.push([])},closeDialog(){a.value.close()},saveJson(){const e=o(s.andData).filter((e=>{if(e.length>0)return e})).map((e=>{const t=e.filter((e=>{if(e.field)return e}));if(t.length>0)return t})).filter((e=>!!e));l("change",e),a.value.close()}}}}),kt=(e=>(C("data-v-2dd0e86c"),e=e(),b(),e))((()=>d("div",{class:"tipContent"},"满足以下所有条件时,此组件可用",-1))),Ft=w(" 删除 "),_t=w("+并条件"),Lt=w("+或条件"),Dt=w("保存"),It=w("关闭");var St=G(xt,[["render",function(e,t,l,a,o,n){const r=m("el-option"),d=m("el-select"),u=m("el-table-column"),c=m("el-input"),f=m("el-form-item"),h=m("el-form"),g=m("el-switch"),C=m("el-button"),b=m("el-table"),w=m("el-main"),x=m("el-footer"),F=m("el-container"),_=m("CustomDialog");return s(),k(N,{to:"body"},[p(_,{ref:"maxJsonDialog",class:"maxJsonDialog"},{default:v((()=>[p(w,{style:{padding:"0"}},{default:v((()=>[p(F,{style:{height:"100%"}},{default:v((()=>[p(w,{class:"my-pageMain"},{default:v((()=>[kt,(s(!0),i(S,null,$(e.andData,((t,l)=>(s(),i("div",{class:"tableContainer",key:l},[p(b,{data:t,style:{width:"100%"}},{default:v((()=>[p(u,{prop:"field",label:"字段"},{default:v((t=>[p(d,{modelValue:t.row.field,"onUpdate:modelValue":e=>t.row.field=e,placeholder:"请选择"},{default:v((()=>[(s(!0),i(S,null,$(e.fieldList,(e=>(s(),k(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),p(u,{prop:"logic",label:"逻辑"},{default:v((t=>[p(d,{modelValue:t.row.logic,"onUpdate:modelValue":e=>t.row.logic=e,placeholder:"请选择"},{default:v((()=>[(s(!0),i(S,null,$(e.getLogic(t.$index,l),(e=>(s(),k(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024),p(u,{prop:"type",label:"值类型"},{default:v((t=>[p(d,{modelValue:t.row.type,"onUpdate:modelValue":e=>t.row.type=e,placeholder:"请选择",onChange:a=>e.handleType(t.$index,l,t.row.type)},{default:v((()=>[(s(!0),i(S,null,$(e.getNewTypeList(t.$index,l),(e=>(s(),k(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024),p(u,{prop:"value",label:"值"},{default:v((t=>[e.getTypeIsChange(t.$index,l)&&"常量"==t.row.type?(s(),k(h,{key:0,model:t.row,rules:e.getRules(t.row.type),ref_for:!0,ref:"formList"},{default:v((()=>[p(f,{prop:"value"},{default:v((()=>[p(c,{type:"text",modelValue:t.row.value,"onUpdate:modelValue":e=>t.row.value=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"])):y("",!0),"选项"==t.row.type?(s(),k(d,{key:1,modelValue:t.row.rightField,"onUpdate:modelValue":e=>t.row.rightField=e,filterable:"",placeholder:"请选择",multiple:e.getMultiple(t.$index,l)},{default:v((()=>[p(r,{label:"未选择",value:""}),(s(!0),i(S,null,$(e.getFiled(t.$index,l),((e,t)=>(s(),k(r,{key:t,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","multiple"])):y("",!0),"布尔"==t.row.type?(s(),k(g,{key:2,modelValue:t.row.value,"onUpdate:modelValue":e=>t.row.value=e,"active-icon":e.Check,"inactive-icon":e.Close},null,8,["modelValue","onUpdate:modelValue","active-icon","inactive-icon"])):y("",!0)])),_:2},1024),p(u,{fixed:"right",label:"操作",width:"100"},{default:v((t=>[p(C,{size:"small",type:"danger",onClick:E((a=>e.deleteRow(t.$index,l)),["prevent"])},{default:v((()=>[Ft])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["data"]),p(C,{class:"mt-4",style:{width:"100%"},type:"text",onClick:t=>e.onAddItem(l)},{default:v((()=>[_t])),_:2},1032,["onClick"])])))),128)),p(C,{class:"mt-4",type:"text",onClick:e.onOrItem},{default:v((()=>[Lt])),_:1},8,["onClick"])])),_:1}),p(x,{class:"my-Footer",style:{height:"60px","padding-top":"10px","text-align":"right"}},{default:v((()=>[p(C,{type:"primary",onClick:e.saveJson},{default:v((()=>[Dt])),_:1},8,["onClick"]),p(C,{onClick:e.closeDialog},{default:v((()=>[It])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},512)])}],["__scopeId","data-v-2dd0e86c"]]);const $t={props:{fieldList:{type:Object,default:()=>({})},data:{type:Object,default:()=>({})}},data:()=>({table:[],groupSelect:[{value:"andgroup",label:"+并组"},{value:"orgroup",label:"+或组"},{value:"data",label:"条件"}],logicList:[{value:"=",label:"等于"},{value:"!=",label:"不等于"}],typeList:[{rule:[],value:"常量",label:"常量"}]}),computed:{newtypeList(){const e=this.fieldList.find((e=>{if(this.table&&this.table.length>0&&e.value==this.table[0].field)return e}));return e&&e.options?[{rule:[],value:"选项",label:"选项"}]:e&&e.switch?[{value:"布尔",label:"布尔"}]:this.typeList}},methods:{handleType(e){"布尔"==e&&(this.table[0].value=!0)},getFiled(){if(!this.table[0]||!this.table[0].field)return[];return this.fieldList.find((e=>{if(this.table&&this.table.length>0&&e.value==this.table[0].field)return e})).options||[]},getMultiple(){return!!this.fieldList.find((e=>{if(this.table&&this.table.length>0&&e.value==this.table[0].field)return e})).multiple},getLogic(){const e=this.fieldList.find((e=>{if(this.table&&this.table.length>0&&e.value==this.table[0].field)return e}));return e&&e.options&&e.multiple?[{value:"in",label:"包含"},{value:"not in",label:"不包含"}]:e&&e.switch?[{value:"=",label:"等于"}]:this.logicList},show(e){this.$refs.maxJsonDialog.init("可用条件","icon-bianji"),this.$refs.maxJsonDialog.show(),Object.keys(e).length>0&&(this.table=[e])},onAddItem(){this.table.push({field:"",logic:"",type:"",value:""})},getTypeIsChange(e){const t=this.table[e];return!!t.type&&"常量"==t.type},getRules(e){var t;return{value:null==(t=this.typeList.find((t=>t.value==e)))?void 0:t.rule}},closeDialog(){this.$refs.maxJsonDialog.close()},deleteRow(){this.table=[]},async saveJson(){if(this.table.length>0){const e=this.table[0];if(!e.field)return void this.$message.error("字段不能为空!");if(!e.type)return void this.$message.error("请选择值类型!");if(e.type&&"选项"==e.type&&!e.value)return void this.$message.error("值类型为字段时值不能为空!");for(const t in this.table[0])this.data[t]=this.table[0][t]}else for(const e in this.data)delete this.data[e];this.$message({message:"保存成功",type:"success"}),this.closeDialog(),this.$emit("end")}}},Tt=w(" 删除 "),Vt=w("+条件"),Nt=w("保存"),Ut=w("关闭");var At=G($t,[["render",function(e,t,l,a,o,n){const r=m("el-option"),d=m("el-select"),u=m("el-table-column"),c=m("el-input"),f=m("el-form-item"),h=m("el-form"),g=m("el-switch"),C=m("el-button"),b=m("el-table"),w=m("el-main"),x=m("el-footer"),F=m("el-container"),_=m("CustomDialog");return s(),k(N,{to:"body"},[p(_,{ref:"maxJsonDialog",class:"maxJsonDialog"},{default:v((()=>[p(w,{style:{padding:"0"}},{default:v((()=>[p(F,{style:{height:"100%"}},{default:v((()=>[p(w,{class:"my-pageMain"},{default:v((()=>[p(b,{data:o.table,style:{width:"100%"},border:""},{default:v((()=>[p(u,{prop:"field",label:"字段"},{default:v((e=>[p(d,{modelValue:e.row.field,"onUpdate:modelValue":t=>e.row.field=t,placeholder:"请选择"},{default:v((()=>[p(r,{label:"未选择",value:""}),(s(!0),i(S,null,$(l.fieldList,((e,t)=>(s(),k(r,{key:t,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),p(u,{prop:"logic",label:"逻辑"},{default:v((e=>[p(d,{modelValue:e.row.logic,"onUpdate:modelValue":t=>e.row.logic=t,placeholder:"请选择"},{default:v((()=>[(s(!0),i(S,null,$(n.getLogic(),(e=>(s(),k(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),p(u,{prop:"type",label:"值类型"},{default:v((e=>[p(d,{modelValue:e.row.type,"onUpdate:modelValue":t=>e.row.type=t,placeholder:"请选择",onChange:n.handleType},{default:v((()=>[(s(!0),i(S,null,$(n.newtypeList,(e=>(s(),k(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),p(u,{prop:"value",label:"值"},{default:v((t=>[n.getTypeIsChange(t.$index,e.index)?(s(),k(h,{key:0,model:t.row,rules:n.getRules(t.row.type),ref:"formList"},{default:v((()=>[p(f,{prop:"value"},{default:v((()=>[p(c,{type:"text",modelValue:t.row.value,"onUpdate:modelValue":e=>t.row.value=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"])):y("",!0),"选项"==t.row.type?(s(),k(d,{key:1,modelValue:t.row.value,"onUpdate:modelValue":e=>t.row.value=e,filterable:"",placeholder:"请选择",multiple:n.getMultiple()},{default:v((()=>[p(r,{label:"未选择",value:""}),(s(!0),i(S,null,$(n.getFiled(),((e,t)=>(s(),k(r,{key:t,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","multiple"])):y("",!0),"布尔"==t.row.type?(s(),k(g,{key:2,modelValue:t.row.value,"onUpdate:modelValue":e=>t.row.value=e,"active-icon":e.Check,"inactive-icon":e.Close},null,8,["modelValue","onUpdate:modelValue","active-icon","inactive-icon"])):y("",!0)])),_:1}),p(u,{fixed:"right",label:"操作",width:"200"},{default:v((t=>[p(C,{size:"mini",type:"danger",onClick:E((l=>n.deleteRow(t.$index,e.index)),["prevent"])},{default:v((()=>[Tt])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),0==o.table.length?(s(),k(C,{key:0,class:"mt-4",type:"text",onClick:n.onAddItem,style:{width:"100%"}},{default:v((()=>[Vt])),_:1},8,["onClick"])):y("",!0)])),_:1}),p(x,{class:"my-Footer",style:{height:"60px","padding-top":"10px"}},{default:v((()=>[p(C,{type:"primary",onClick:n.saveJson},{default:v((()=>[Nt])),_:1},8,["onClick"]),p(C,{onClick:n.closeDialog},{default:v((()=>[Ut])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},512)])}],["__scopeId","data-v-240d35d0"]]);const Et={name:"ConditionGroup",components:{ConditionTanc:At},props:{result:{type:Object,default:()=>({})},index:{type:Number,default:0},fieldList:{type:Array,default:()=>[]},rightField:{type:Array,default:()=>[]},request:{type:Array,default:()=>[]}},data:()=>({groupSelect:[{value:"andgroup",label:"+并组"},{value:"orgroup",label:"+或组"},{value:"data",label:"条件"}]}),watch:{result:{handler(){this.$forceUpdate()},deep:!0}},methods:{onAddItem(){if(this.result.type){switch(this.result.result||"data"==this.result.type||(this.result.result=[]),"data"!=this.result.type||this.result.data||(this.result.data={}),this.result.control=!0,this.result.type){case"orgroup":this.result.result.push({type:"orgroup",result:[]});break;case"andgroup":this.result.result.push({type:"andgroup",result:[]});break;case"data":this.result.result.push({type:"data",data:{}})}this.handleUpdateForce()}},handleControl(e){this.result.control=e,this.handleUpdateForce()},onDeleteItem(){0==this.index?(delete this.result.data,delete this.result.result,delete this.result.type,this.handleUpdateForce()):this.$emit("delete",this.index)},handleDelete(e){this.result.result.splice(e,1),this.handleUpdateForce()},onChange(e){this.result.type=e,"andgroup"==e||"orgroup"==e?(this.result.result=[],this.result.data&&delete this.result.data):(this.result.data={},this.result.result&&delete this.result.result),this.handleUpdateForce()},handleUpdateForce(){this.$forceUpdate(),this.$emit("update")},onEditData(){this.$refs.ConditionTanc.show(this.result.data)}}},jt={class:"control"},Jt=w("增加条件"),Rt=w("删除"),Mt=w("编辑"),Ot={class:"moreCondition"};var Pt=G(Et,[["render",function(e,t,l,a,o,n){const r=m("el-option"),u=m("el-select"),c=m("el-button"),f=m("ConditionGroup",!0),h=m("ConditionTanc");return s(),i("div",{class:g(["conditionSelect",l.result.type])},[L(d("div",jt,[l.result.control?(s(),i("span",{key:1,class:"iconfont icon-jianhao",onClick:t[1]||(t[1]=e=>n.handleControl(!1))})):(s(),i("span",{key:0,class:"iconfont icon-jiahao",onClick:t[0]||(t[0]=e=>n.handleControl(!0))}))],512),[[D,l.result.result&&l.result.result.length>0&&"data"!==l.result.type]]),p(u,{modelValue:l.result.type,"onUpdate:modelValue":t[2]||(t[2]=e=>l.result.type=e),placeholder:"请选择",onChange:n.onChange},{default:v((()=>[(s(!0),i(S,null,$(o.groupSelect,(e=>(s(),k(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),p(c,{type:"primary",onClick:n.onAddItem,size:"mini",disabled:!l.result.type||"data"==l.result.type},{default:v((()=>[Jt])),_:1},8,["onClick","disabled"]),p(c,{type:"danger",onClick:n.onDeleteItem,size:"mini"},{default:v((()=>[Rt])),_:1},8,["onClick"]),"data"==l.result.type?(s(),k(c,{key:0,type:"primary",onClick:n.onEditData,size:"mini"},{default:v((()=>[Mt])),_:1},8,["onClick"])):y("",!0),p(T,null,{default:v((()=>[L(d("div",Ot,[(s(!0),i(S,null,$(l.result.result,((e,t)=>(s(),i("div",{key:t,class:"selectList"},[p(f,{result:e,onUpdate:n.handleUpdateForce,onDelete:n.handleDelete,index:t,fieldList:l.fieldList},null,8,["result","onUpdate","onDelete","index","fieldList"])])))),128)),l.result.result&&l.result.result.length>=2?(s(),i("div",{key:0,class:g(["line",l.result.type])},null,2)):y("",!0)],512),[[D,l.result.type&&"data"!==l.result.type&&l.result.control]])])),_:1}),L(d("div",null,[p(h,{ref:"ConditionTanc",data:l.result.data,fieldList:l.fieldList,onEnd:n.handleUpdateForce},null,8,["data","fieldList","onEnd"])],512),[[D,l.result.type&&"data"==l.result.type]])],2)}],["__scopeId","data-v-23989ab6"]]);const Wt={components:{ConditionGroup:Pt},props:{data:{type:Object,default:()=>({})},item:{type:Object,default:()=>({})}},data:()=>({result:{},stringLink:"",leftField:[],rightField:[],condition:[],request:[]}),watch:{result:{handler(){console.log(this.result),this.$forceUpdate()},deep:!0}},methods:{async show(){var e;this.$refs.maxJsonDialog.init("可用条件","icon-bianji"),this.$refs.maxJsonDialog.show(),await this.$nextTick();const t=null==ne?void 0:ne.get("allFormList"),l=null==(e=o(t))?void 0:e.filter((e=>{if(e.data.fieldName!==this.data.fieldName)return e})).map((e=>{var t,l,a,o,n,i,s,r,d;if("开关"==e.nameCn)return{value:null==(t=null==e?void 0:e.data)?void 0:t.fieldName,label:(null==(l=null==e?void 0:e.data)?void 0:l.label)+"-"+(null==(a=null==e?void 0:e.data)?void 0:a.fieldName),switch:!0};if(e.data.itemConfig){let t=!1;Array.isArray(e.data.itemConfig.value)&&(t=!0);const l=e.data.itemConfig.items;return{value:null==(o=null==e?void 0:e.data)?void 0:o.fieldName,label:(null==(n=null==e?void 0:e.data)?void 0:n.label)+"-"+(null==(i=null==e?void 0:e.data)?void 0:i.fieldName),multiple:t,options:l}}return{value:null==(s=null==e?void 0:e.data)?void 0:s.fieldName,label:(null==(r=null==e?void 0:e.data)?void 0:r.label)+"-"+(null==(d=null==e?void 0:e.data)?void 0:d.fieldName)}}));this.result="string"==typeof this.data[this.item.data.fieldName]?JSON.parse(this.data[this.item.data.fieldName]):this.data[this.item.data.fieldName],console.log(l),this.leftField=l},handleUpdateForce(){this.$forceUpdate(),this.stringLink=this.filterCondition(this.result),console.log(this.stringLink)},filterCondition(e){if("andgroup"==e.type||"orgroup"==e.type){const t=e.result.map((e=>this.filterCondition(e))).join("andgroup"==e.type?'<span class="and">and</span>':'<span class="or">or</span>');return`<span class='kh ${e.type}'>(${t})</span>`}return"data"==e.type?`<span class='data kh'>${this.getDataConditionRelate(e)}</span>`:""},getDataConditionRelate(e){if(0==Object.keys(e.data).length)return"空";const t=e.data,l=t.field;let a;if("选项"==t.type){const e=t.value;a=`${JSON.stringify(e)}`}else"常量"!=t.type&&"布尔"!=t.type||(a=t.value);return`${l} ${t.logic} ${a}`},closeDialog(){this.$refs.maxJsonDialog.close()},saveJson(){this.$emit("change",this.result),this.closeDialog()}}},zt=d("div",{class:"tipContent"},"满足以下所有条件时,此组件可用",-1),Bt={class:"conditionContainer"},Ht={class:"stringlist"},qt=["innerHTML"],Gt=w("保存"),Xt=w("关闭");var Kt=G(Wt,[["render",function(e,t,l,a,o,n){const i=m("ConditionGroup"),r=m("el-main"),u=m("el-button"),c=m("el-footer"),f=m("el-container"),h=m("CustomDialog");return s(),k(h,{ref:"maxJsonDialog",class:"maxJsonDialogss"},{default:v((()=>[p(r,{style:{padding:"0"}},{default:v((()=>[p(f,{style:{height:"100%"}},{default:v((()=>[p(r,{class:"my-pageMain"},{default:v((()=>[zt,d("div",Bt,[p(i,{result:o.result,onUpdate:n.handleUpdateForce,fieldList:o.leftField},null,8,["result","onUpdate","fieldList"]),d("div",Ht,[d("pre",{innerHTML:o.stringLink},null,8,qt)])])])),_:1}),p(c,{class:"my-Footer",style:{height:"60px","padding-top":"10px"}},{default:v((()=>[p(u,{type:"primary",onClick:n.saveJson},{default:v((()=>[Gt])),_:1},8,["onClick"]),p(u,{onClick:n.closeDialog},{default:v((()=>[Xt])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},512)}]]);const Yt=e({props:{active:Boolean,currentIndex:Number,len:Number,inline:Boolean,layout:Boolean},mounted(){console.log(this.currentIndex),console.log(this.len)},setup(e,l){const a=t(!1),o=t(),{emit:n}=l,i=r((()=>ne.get("copyContent")));V((()=>e.active),(()=>{e.active||(a.value=e.active)}));return{isShow:a,handleShortCut:t=>{if(e.active){t.preventDefault(),a.value=!0;const e=t.offsetX,l=t.offsetY;_((()=>{o.value.style.left=e+"px",o.value.style.top=l+"px"}))}},handleMenu:()=>{a.value=!1},editForm:o,handleActive:e=>{"copy"===e?de():"paste"===e?(n("paste"),ue()):"cut"===e?ce():"delete"===e?pe():"top"===e?me():"bottom"===e&&fe()},handleCopyAndPaste:()=>{de(),n("paste"),ue()},copyContent:i}}}),Zt={class:"editForm",ref:"editForm"},Qt={key:0,class:"editbar"};var el=G(Yt,[["render",function(e,t,l,a,o,n){return s(),i("div",{class:g(["shape",e.active?e.layout?"shape_border shape_border_layout":"shape_border":e.layout?"noactive_layout":""]),onContextmenu:t[10]||(t[10]=(...t)=>e.handleShortCut&&e.handleShortCut(...t)),onClick:t[11]||(t[11]=(...t)=>e.handleMenu&&e.handleMenu(...t)),style:c({display:e.inline?"inline-block":"block"})},[L(d("div",Zt,[d("span",{onClick:t[0]||(t[0]=t=>e.handleActive("copy"))},"复制"),d("span",{onClick:t[1]||(t[1]=t=>e.handleActive("cut"))},"剪切"),d("span",{onClick:t[2]||(t[2]=t=>e.handleActive("delete"))},"删除"),e.copyContent?(s(),i("span",{key:0,onClick:t[3]||(t[3]=t=>e.handleActive("paste"))},"粘贴")):y("",!0),0!=e.currentIndex?(s(),i("span",{key:1,onClick:t[4]||(t[4]=t=>e.handleActive("top"))},"上移")):y("",!0),e.currentIndex!=e.len-1?(s(),i("span",{key:2,onClick:t[5]||(t[5]=t=>e.handleActive("bottom"))},"下移")):y("",!0)],512),[[D,e.isShow&&e.active]]),u(e.$slots,"default"),e.active?(s(),i("div",Qt,[0!=e.currentIndex?(s(),i("span",{key:0,class:"iconfont icon-xiangshang1",onClick:t[6]||(t[6]=t=>e.handleActive("top"))})):y("",!0),e.currentIndex!=e.len-1?(s(),i("span",{key:1,class:"iconfont icon-xiangxia1",onClick:t[7]||(t[7]=t=>e.handleActive("bottom"))})):y("",!0),d("span",{class:"iconfont icon-fuzhi",onClick:t[8]||(t[8]=(...t)=>e.handleCopyAndPaste&&e.handleCopyAndPaste(...t))}),d("span",{class:"iconfont icon-shanchu1",onClick:t[9]||(t[9]=t=>e.handleActive("delete"))})])):y("",!0)],38)}]]),tl=B();const ll=j(pt);window.VApp=ll,ll.config.globalProperties.$EventBus=tl,ll.config.globalProperties.$Flex=ie,window.VueContext={$Flex:ie},window.JSONEditor=q,ll.component("CustomDialog",wt),ll.component("ConditionSelect",St),ll.component("HighConditionSelect",Kt),ll.component("draggable",x),ll.component("Shape",el),ll.use(H).use(R,{locale:M}),ll.mount("#app");
